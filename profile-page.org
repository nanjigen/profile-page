
* Cloud configuration
:PROPERTIES:
:CREATED:  [2022-09-22 Thu 16:57]
:ID:       e5f2285b-68f5-43a0-bc00-5a20fc657a73
:END:

** MX records
:PROPERTIES:
:CREATED:  [2023-01-06 Fri 15:03]
:ID:       9bb17b3f-9aec-475b-9847-12d73c5aceb3
:END:

danielotto.jp.  IN MX 10 mxext1.mailbox.org.
danielotto.jp.  IN MX 10 mxext2.mailbox.org.
danielotto.jp.  IN MX 20 mxext3.mailbox.org.

** terraform
:PROPERTIES:
:CREATED:  [2023-07-05 Wed 20:20]
:ID:       78254fce-8dd7-43f9-86a2-e202123486d8
:END:
https://cloud.google.com/storage/docs/hosting-static-website?_gl=1*syu26l*_ga*MTMwNzgxMzE4MC4xNjgzNDU4Mzcw*_ga_WH2QY8WWF5*MTY4ODU1MDY4MS4xLjEuMTY4ODU1MDY4NC4wLjAuMA..&_ga=2.92324061.-1307813180.1683458370#storage-create-bucket-terraform
https://registry.terraform.io/modules/gruntwork-io/static-assets/google/latest/submodules/cloud-storage-static-website
https://cloud.google.com/storage/docs/static-website#specialty_pages
Here we write out a =terraform= configuration declaring IAC to deploy a static website with a custom domain on Google cloud storage. This makes use of the =cloud-storage-static-website= module.

The storage bucket is created in the asia-northeast1 region, allowing the site to be situated in Tokyo based servers.

Setup the bucket:
+#name: terraform-main
#+begin_src terraform :tangle tf/main.tf
# Create new storage bucket in the asia-northeast1 region
# and settings for main_page_suffix and not_found_page
resource "random_id" "bucket_prefix" {
  byte_length = 8
}

resource "google_storage_bucket" "static_website" {
  name          = "${random_id.bucket_prefix.hex}-static-website-bucket"
  location      = "ASIA-NORTHEAST1"
  storage_class = "STANDARD"
  website {
    main_page_suffix = "index.html"
    not_found_page   = "404.html"
  }
}

# Upload a simple index.html page to the bucket
resource "google_storage_bucket_object" "indexpage" {
  name         = "index.html"
  content      = "<html><body>Hello World!</body></html>"
  content_type = "text/html"
  bucket       = google_storage_bucket.static_website.id
}

# Upload a simple 404 / error page to the bucket
resource "google_storage_bucket_object" "errorpage" {
  name         = "404.html"
  content      = "<html><body>404!</body></html>"
  content_type = "text/html"
  bucket       = google_storage_bucket.static_website.id
}
#+end_src

** git deployment
:PROPERTIES:
:CREATED:  [2022-09-28 Wed 15:29]
:ID:       bd762a86-cf35-4873-ace8-1c6ddb80c862
:header-args: :tangle no :eval no
:END:
https://medium.com/interleap/automating-terraform-deployment-to-google-cloud-with-github-actions-17516c4fb2e5

Github Action
#+begin_src yaml :tangle .github/workflows/workflow.yaml

#+end_src


* Theme
:PROPERTIES:
:CREATED:  [2022-09-22 Thu 16:57]
:ID:       3c505129-0b7a-44a5-91a9-e48bb46413fc
:header-args: :eval no
:END:
** main
:PROPERTIES:
:CREATED:  [2022-10-09 Sun 18:24]
:ID:       7e9b9c56-f9f6-4d51-9f13-245a4268897d
:END:
#+begin_src css :tangle theme/static/css/main.css
@import "common.css" screen;
@import "colors.css" screen;

:root {
    --background: var(--theme-dracula-background);
    --foreground: var(--theme-dracula-foreground);
    --foreground-secondary: #bfbfbf;

    /* --- --- --- Syntax Highlighting for Code Sections --- --- ---  */
    ---code-background:           var(--theme-dracula-background);
    ---code-foreground:           var(--theme-dracula-foreground);
    ---code-builtin:              var(--theme-dracula-builtin);
    ---code-comment:              var(--theme-dracula-comment);
    ---code-doc:                  var(--theme-dracula-doc);
    ---code-function-name:        var(--theme-dracula-function-name);
    ---code-keyword:              var(--theme-dracula-keyword);
    ---code-string:               var(--theme-dracula-string);
    ---code-type:                 var(--theme-dracula-type);
    ---code-variable-name:        var(--theme-dracula-variable-name);
    ---code-rainbow1:             var(--theme-dracula-rainbow1);
    ---code-rainbow2:             var(--theme-dracula-rainbow2);
    ---code-rainbow3:             var(--theme-dracula-rainbow3);
    ---code-rainbow4:             var(--theme-dracula-rainbow4);
}

body                             { background: var(--background); color: var(--foreground); }

/* -- Code Blocks -- */
.org-builtin                     { color: var(---code-builtin); }
.org-comment                     { color: var(---code-comment); }
.org-comment-delimiter           { color: var(---code-comment); }
.org-doc                         { color: var(---code-doc); }
.org-function-name               { color: var(---code-function-name); }
.org-keyword                     { color: var(---code-keyword); }
.org-string                      { color: var(---code-string); }
.org-type                        { color: var(---code-type); }
.org-variable-name               { color: var(---code-variable-name); }
.org-src-container               { color: var(---code-foreground);
                                   background: var(---code-background);
                                   border: 1px solid var(---border-src); }
.org-rainbow-delimiters-depth-1  { color: var(---code-rainbow1); }
.org-rainbow-delimiters-depth-2  { color: var(---code-rainbow2); }
.org-rainbow-delimiters-depth-3  { color: var(---code-rainbow3); }
.org-rainbow-delimiters-depth-4  { color: var(---code-rainbow4); }
.org-rainbow-delimiters-depth-5  { color: var(---code-rainbow1); }
.org-rainbow-delimiters-depth-6  { color: var(---code-rainbow2); }
.org-rainbow-delimiters-depth-7  { color: var(---code-rainbow3); }
.org-rainbow-delimiters-depth-8  { color: var(---code-rainbow4); }
.org-rainbow-delimiters-depth-9  { color: var(---code-rainbow1); }
.org-rainbow-delimiters-depth-10 { color: var(---code-rainbow2); }
.org-rainbow-delimiters-depth-11 { color: var(---code-rainbow3); }
.org-rainbow-delimiters-depth-12 { color: var(---code-rainbow4); }


.pubdate { color: var(--foreground-secondary); }
#+end_src
** common
:PROPERTIES:
:CREATED:  [2022-10-09 Sun 18:24]
:ID:       6d7e0f09-41a9-4671-8f4e-0f386d9c1f7c
:END:
#+begin_src css  :tangle theme/static/css/common.css
/* Document configurations */
body                 { padding: 0px; margin: 0px; font-family: monospace, sans-serif; font-size: 16pt;
                       line-height: 32px; display: flex; flex-direction: column; min-height: 100vh; }

/* Titles */
h1, h2, h3, h4, h5   { padding: 0; margin-top: 60px; color: #83a598; }
h1                   { font-size: 55px; line-height: 1.1em; }
h2                   { font-size: 40px; line-height: 1.1em; }
h3                   { font-size: 30px; line-height: 1.1em; }

/* links */
a                    { color: #bd93f9; text-decoration: none; }
a:hover              { color: #fff; }

/* Horizontal bar */
hr                   { border-top: 0; border-bottom: solid 1px #3c3836; }

/* Element that wraps everything */
.container           { width: calc(55% - 100px); padding: 10px 150px; margin: 0 auto; }

/* Elements that can appear anywhere */
.note                { background-color: #504945; padding: 5px 25px; border-radius: 10px; }
.centralized img     { margin: auto auto; display: block; }

/* Top bar with the badges */
.social              { margin: 60px 0; }
.social .avatar      { width: 100px; height: 100px; display: block; margin: 0 auto; float: left;
                       background-color: #bd93f9; border-radius: 10px; padding: 6px 4px; }
.social .badges      { float: right; width: 155px; font-size: 36px; list-style: none; display: block; }
.social .badges li   { padding-left: 8px; float: left; }
.social .badges a    { float: left; display: block; width: 36px; height: 36px; overflow: hidden; margin-left: 5px; padding: 1px;
                       color: #50fa7b; }
.social .badges a:hover { color: #bd93f9; }
.social .badges a span  { height: 50px; }

/* Footer */
.footer              { font-size: .8em; margin: 0; }
.footer .email-link  { text-align: center; font-size: 30px; color: #44475a; padding: 40px 0; }
.footer .bg          { background: #44475a; padding: 40px 0; }
.footer a            { color: #000; text-decoration: none; }
.footer a:hover      { text-decoration: underline; background: transparent; }

/* Listing */
ul.posts            { padding-left: 20px; }
ul.posts li         { padding-bottom: 20px; }
ul.posts span.date  { padding-right: 5px; text-align: right; }
ul.posts .comment   { padding-top: 10px;  color: #666; }

/* For pages that list posts */
.content.slides > ul,
.content.blog > ul  { list-style: none;  padding: 0; }
.content.slides > ul > li,
.content.blog > ul > li { margin-bottom: 10px; }

/* Content formatting */
#content            { width: calc(60% - 100px); padding: 10px 150px; margin: auto auto; color: #333; }
.post               { display: block; min-height: 70vh; display: flex; flex-grow: 1; flex-direction: column; }
.subtitle { color: #aaa; }

/* Code blocks */
code                { background: #3c3836; color: #fff; padding: 0 0.5rem; border-radius: 3px; }
.org-src-container  { overflow-x: auto; padding: 10px 40px; border-radius: 10px; margin: 20px 0; line-height: 1.3; }

/* Very small width */
@media (max-width: 480px) {
    h1                   { margin-top: 20px; }
    .social              { margin: 20px 0; }
    .social .badges      { padding: 0 20px 0 0; }
    .container,
    #content, .container { width: 90%; padding: 10px; }
}

/* Medium width */
@media (min-width: 480px) and (max-width: 1000px) {
    .social              { margin: 20px 0; }
    #content, .container,
    .container           { width: 80%; padding: 10px; }
}
#+end_src

** colors
:PROPERTIES:
:CREATED:  [2022-10-09 Sun 18:24]
:ID:       76fe91b2-6299-401f-9cb1-69ba8adffe14
:END:
#+begin_src css :tangle theme/static/css/colors.css
:root {
    --theme-dracula-background              : #141d28;
    --theme-dracula-background-secondary-alt: #44475a;
    --theme-dracula-background-secondary    : #1e1f29;
    --theme-dracula-foreground              : #f8f8f2;
    --theme-dracula-sidebar-background      : #233346;
    /*COLOURS */
    --theme-dracula-green                   : #50fa7b;
    --theme-dracula-violet                  : #bd93f9;
    --theme-dracula-magenta                 : #ff79c6;
    --theme-dracula-orange                  : #ffb86c;
    --theme-dracula-cyan:                     #8be9fd;
    --theme-dracula-red:                      #ff5555;
    --theme-dracula-yellow:                   #f1fa8c;
    --theme-dracula-body-text:               : #C3C3C3;
    --theme-dracula-comment:                 : #6272a4;
    --theme-dracula-doc:                    var(--theme-dracula-cyan);
    --theme-dracula-function-name:          var(--theme-dracula-green);
    --theme-dracula-keyword:                var(--theme-dracula-magenta);
    --theme-dracula-string:                 var(--theme-dracula-yellow);
    --theme-dracula-type:                   var(--theme-dracula-violet);
    --theme-dracula-rainbow1:               var(--theme-dracula-magenta);
    --theme-dracula-rainbow2:               var(--theme-dracula-violet);
    --theme-dracula-rainbow3:               var(--theme-dracula-green);
    --theme-dracula-rainbow4:               var(--theme-dracula-yellow);
    --theme-dracula-variable-name:          var(--theme-dracula-magenta);
    --theme-dracula-page-links              : #C26EFF;
    --theme-dracula-attributes-color        : #FFFF80;
    --theme-dracula-external-links          : #7CE973;
    --theme-dracula-links-hover             : #92FFFF;
    --theme-dracula-hashtags                : #FFD17E;
    --theme-dracula-italics-color           : #FF7EA2;
    --theme-dracula-bold-color              : #FF4E4E;
    --theme-dracula-highlight-text-color    : #47405E;
    --theme-dracula-highlighter             : #FFFF80;
    --theme-dracula-sidebar-text            : #F2F2F2;
    --theme-dracula-page-heading            : #FFBE49;
    --theme-dracula-daily-heading           : #FFCA6A;
    --theme-dracula-headings                : #F2F2F2;
    --theme-dracula-bullets                 : #7A6DAA;
    --theme-dracula-closed-bullets          : #3E445D;
    --theme-dracula-references              : #9E8DDB;
    --theme-dracula-block-reference-text    : #FF9580;
    --theme-dracula-namespaces              : #5EB9FF;
    --theme-dracula-all-pages-mentions      : #FF9580;
    --theme-dracula-cursor                  : #F2F2F2;
    --theme-dracula-icons                   : #FBCC77;
    --theme-dracula-icons-hover             : #81FFEA;
    --theme-dracula-filter-icon             : #C26EFF;
    /* DROPDOWN MENU */
    --theme-dracula-dropdown-menu-background: #1E2B3B;
    --theme-dracula-dropdown-menu-highlight : #454259;
    --theme-dracula-dropdown-menu-text      : #F2F2F2;
    --theme-dracula-dropdown-newpage        : #9580FF;
    /* SEARCH BAR */
    --theme-dracula-search-bar-background   : #19191E;
    --theme-dracula-search-bar-text         : #F2F2F2;
    /* KANBAN CARD COLORS */
    --theme-dracula-kanban-main-background  : #1B1A23;
    --theme-dracula-kanban-column-background: #2A2C37;
    --theme-dracula-kanban-card-background  : #1B1A23;
    --theme-dracula-kanban-text-hover       : #81FFEA;
}
#+end_src

** Templates
:PROPERTIES:
:CREATED:  [2022-10-09 Sun 18:23]
:ID:       7d8f1b58-b897-46ac-a990-20fe9304c4d8
:END:

*** index
:PROPERTIES:
:CREATED:  [2022-10-09 Sun 18:36]
:ID:       4430ba49-0262-4777-b7a5-eb8ff9eb1122
:END:
#+begin_src html  :tangle theme/templates/index.html
{# index.html --- Template for my website's index page -*- Mode: Jinja2; -*- #}
{% extends "layout.html" %}

{% block body %}
  <h1>{{ post.title }}</h1>

  {{ post.html|safe }}
{% endblock %}
#+end_src

*** layout
:PROPERTIES:
:CREATED:  [2022-10-09 Sun 18:36]
:ID:       8c8ea744-8cf8-491b-ae38-476c864549c7
:END:
#+begin_src html  :tangle theme/templates/layout.html
{# layout.html --- Base template for all other templates -*- Mode: Jinja2; -*-

The blocks available in this file are:

,* title: What will show within the HTML <title> tag.
,* description: What will show within the HTML <meta> description tag.
,* nav: Navigation bar with Links, a default is provided
,* body: Main content which starts empty
,* footer: Bottom links, default is provided

#}
<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <title>Daniel &mdash; {% block title %}Home{% endblock %}</title>
    <meta name="description" content="{% block description %}{% endblock %}">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/static/css/main.css">
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <link rel="icon" type="image/png" href="/static/img/lambda-in-8bit.png">
    <link rel="alternate" type="application/rss+xml" href="/blog/rss.xml">
  </head>
  <body>
    {% block nav %}
      <div class="social">
        <div class="container">
          <ul class="badges">
            <li>
              <a href="mailto:translation@danielotto.jp" alt="Email">
                <span class="fa fa-envelope-o"></span>EMail
              </a>
            </li>
            <li>
              <a href="https://github.com/nanjigen" target="_blank" alt="Github">
                <span class="fa fa-github-alt"></span>Github
              </a>
            </li>
            <li>
              <a href="https://linkedin.com/in/dmotto" target="_blank" alt="LinkedIn">
                <span class="fa fa-linkedin"></span>LinkedIn
              </a>
            </li>
            <li>
              <a href="/blog/rss.xml" alt="RSS">
                <span class="fa fa-rss"></span>RSS
              </a>
            </li>
          </ul>
          <a href="/">
            <img class="avatar" type="image/svg+xml" src="/static/img/lambda-in-8bit.svg" alt="lambda" />
          </a>
        </div>
      </div>
    {% endblock %}

    <div class="post">
      <div class="container">
        {% block body %}{% endblock %}
      </div>
    </div>

    <div class="footer">
      {% block footer %}
        <div class="bg">
          <div class="container">
            &#169; Daniel Otto &mdash; All written content on this
            website reflects my personal opinion and it's available
            under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a>
          </div>
        </div>
      {% endblock %}
    </div>
  </body>
</html>
#+end_src
* publish.el
:PROPERTIES:
:CREATED:  [2022-10-09 Sun 18:14]
:ID:       8c6bdab7-8977-40b2-a575-80bdb7cf4966
:END:

The below is required to get the right dependencies
#+begin_src elisp :tangle publish.el :results silent
;; Guarantee the freshest version of the weblorg
(add-to-list 'load-path "~/.emacs.d/.local/straight/repos/weblorg")
(add-to-list 'load-path "~/.emacs.d/.local/straight/repos/templatel")
(require 'weblorg)
(require 'templatel)

;; Setup package management
(require 'package)
(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)
(package-initialize)
(unless (package-installed-p 'use-package)
  (package-refresh-contents)
  (package-install 'use-package))

(use-package rainbow-delimiters :config :ensure t)

;; Install and configure dependencies
(use-package templatel :ensure t)
(use-package htmlize
  :ensure t
  :config
  (setq org-html-htmlize-output-type 'css))
#+end_src

#+begin_src elisp :tangle publish.el :results silent
(weblorg-site
 :template-vars '(("site_name" . "Daniel Otto's profile site")
                  ("site_author" "Daniel Otto")
                  ("site_email" . "techlisper@danielotto.jp")
                  ("site_description" . "My personal profile and blog about Linguistics, computing and translation.")))

(setq weblorg-default-url "http://www.danielotto.jp")

(weblorg-route
 :name "index"
 :input-pattern "index.org"
 :template "index.html"
 :output "index.html"
 :url "/")

;; route for rendering each post
(weblorg-route
 :name "posts"
 :input-pattern "posts/*.org"
 :template "post.html"
 :output "blog/posts/{{ slug }}.html"
 :url "/blog/{{ slug }}.html")

;; route for rendering the index page of the blog
(weblorg-route
 :name "blog"
 :input-pattern "posts/*.org"
 :input-aggregate #'weblorg-input-aggregate-all-desc
 :template "blog.html"
 :output "blog/index.html"
 :url "/")

;; route for rendering each page
(weblorg-route
 :name "pages"
 :input-pattern "pages/*.org"
 :template "page.html"
 :output "output/{{ slug }}.html"
 :url "/{{ slug }}.html")

;; route for static assets that also copies files to output directory
(weblorg-copy-static
 :output "static/{{ file }}"
 :url "/static/{{ file }}")

;; fire the engine and export all the files declared in the routes above
(weblorg-export)
#+end_src

* NEXT Fix encryption on profile site                               :@computer:
:PROPERTIES:
:TRIGGER:  chain-find-next(NEXT,from-current,priority-up,effort-down)
:CREATED:  [2023-01-06 Fri 15:03]
:ID:       4e88e18a-fcf1-44d5-827b-5b8966056c54
:END:
